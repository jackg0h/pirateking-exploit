var unityObjectUrl = "http://webplayer.unity3d.com/download_webplayer-3.x/3.0/uo/UnityObject2.js";
if (document.location.protocol == 'index.html')
	unityObjectUrl = unityObjectUrl.replace("http://", "https://ssl-/");
document.write('<script type="text\/javascript" src="' + unityObjectUrl + '"><\/script>');

var u;

var config = {
	width: 760, 
	height: 660,
	params: 
	{ 
		enableDebugging:"0",
		backgroundcolor: "00a9e6",
		textcolor: "FFFFFF",
		logoimage: "https://d1ahaanseclbt3.cloudfront.net/Canvas/Images/Jelly_logo.png",
		progressbarimage: "https://d1ahaanseclbt3.cloudfront.net/Canvas/Images/Bar_002.png",
		progressframeimage: "https://d1ahaanseclbt3.cloudfront.net/Canvas/Images/Bar_01.png",
		disableContextMenu: true
	}
};

// Initialize Unity
$( document ).ready(function() {
	u = new UnityObject2(config);
	jQuery(function() {
		var $missingScreen = jQuery("#unityPlayer").find(".missing");
		var $brokenScreen = jQuery("#unityPlayer").find(".broken");
		$missingScreen.hide();
		$brokenScreen.hide();
			
		u.observeProgress(function (progress) {
			switch(progress.pluginStatus) {
				case "broken":
					$brokenScreen.find("a").click(function (e) {
						e.stopPropagation();
						e.preventDefault();
						u.installPlugin();
						return false;
					});
					$brokenScreen.show();
				break;
				case "missing":
					$missingScreen.find("a").click(function (e) {
						e.stopPropagation();
						e.preventDefault();
						u.installPlugin();
						return false;
					});
					$missingScreen.show();
				break;
				case "installed":
					$missingScreen.remove();
				break;
				case "first":
				break;
			}
		});
		u.initPlugin(jQuery("#unityPlayer")[0], "https://d1ahaanseclbt3.cloudfront.net/Canvas/" +  unityFileName + ".unity3d");
	});
});

function changeImage(control, newImageUrl)
{
	control.src = "https://d1ahaanseclbt3.cloudfront.net/Canvas/Images/" + newImageUrl + ".png";
}

function clickPlay()
{
	if (isPopupShown)
	{
		togglePopup();
	}
}

function clickInvite()
{
	u.getUnity().SendMessage("Managers", "WPShowInvite", null);
}

function clickBuySpins()
{
	u.getUnity().SendMessage("Managers", "WPBuySpins", null);
}

function clickMobile()
{
	togglePopup();
}

function clickBuy()
{
	var ddl = document.getElementById("ddlPremiums");
	var selectedIndex = ddl.selectedIndex;
	if (selectedIndex < 0) { return; }
	var selected = ddl.options[selectedIndex];
	u.getUnity().SendMessage("Managers", "WPBuy", selected.value);
}

function RegisterPremiumItems(jsonData)
{
	if (jsonData == null)
	{
		return;
	}
	var ddl = document.getElementById("ddlPremiums");
	var data = JSON.parse(jsonData);
	for (var i = 0; i < data.length; i++)
	{
		var item = data[i];
		var type = item.Type;
		var amount = numberWithCommas(item.Amount);
		var price = item.Price + " " + item.Currency;
		var id = item.ID;
		
		var text = "";
		if (type == 0) // Spins
		{
			text = amount + " spins for " + price;
		}
		else if (type == 1) // Cash
		{
			text = amount + " coins for " + price;
		}
				
		ddl.options.add(new Option(text, id + ";" + type));
	}
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Popup code
var isPopupShown = false;
            
function togglePopup() {
	var unity = $("#unityPlayer");
	var popup = $("#mobilePopup");
	
	if (unity == null || popup == null)	{
		return;
	}
	
	if (!isPopupShown) {
		unity.css("visibility", "hidden");
		popup.css("display", "");
	} else {
		popup.css("display", "none");
		unity.css("visibility", "visible");
	}
	isPopupShown = !isPopupShown;
}